<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script type="text/javascript" src="js/library/phaser.js"></script>
    <title>Title</title>
</head>
<body>
    <div id="container"></div>

    <script type="text/javascript">
        var game = new Phaser.Game(512, 600, Phaser.AUTO, 'container', {
            preload: preload,
            create: create,
            update: update
        });

        function preload() {
            game.load.image('enemyTest', './assets/Enemy/gruntFairyRed.png');
            game.load.image('sanae', './assets/Player/player1Stand.png');
            game.load.image('singlePrimary', './assets/Player/player1ShotA.png');
            game.load.image('doublePrimary', './assets/Player/player1ShotB.png');
            game.load.image('spreadPrimary', './assets/Player/secondaryShotALT.png');
        }

        var weapon1;
        var weapon2;
        var player;
        var cursors;
        var fireButton;
        var grunts;
        // weapon.Bullets is a group
        function create() {
            // ___WEAPONS___

            // Single Shot
            weapon1 = game.add.weapon(30, 'singlePrimary');
            weapon1.bulletKillType = Phaser.Weapon.KILL_WORLD_BOUNDS;
            weapon1.bulletAngleOffset = 90;
            weapon1.bulletSpeed = 850;
            weapon1.fireRate = 90;
            weapon1.bullets.forEach(function(bullet) {
                bullet.damageAmount = 4;
            });

            weapon2 = game.add.weapon(30, 'doublePrimary');
            weapon2.bulletKillType = Phaser.Weapon.KILL_WORLD_BOUNDS;
            weapon2.bulletAngleOffset = 90;
            weapon2.bulletSpeed = 850;
            weapon2.fireRate = 90;

            // Enemies
            grunts = game.add.group();
            grunts.enableBody = true;
            grunts.physicsBodyType = Phaser.Physics.ARCADE;
            for (var i = 0; i < 5; i++) {
                var g = grunts.create(game.world.randomX, game.world.randomY, 'enemyTest');
                g.body.immovable = true;
            }
            grunts.setAll('anchor.x', 0.5);
            grunts.setAll('anchor.y', 0.5);
            grunts.setAll('outOfBoundsKill', true);
            grunts.setAll('checkWorldBounds', true);
            grunts.setAll('health', 10);

            grunts.forEach(function(enemy) {
                enemy.damageAmount = 10;
            });

            // Player
            player = this.add.sprite((game.world.width/2) - 13, game.world.height - 150, 'sanae');
            player.health = 1;

            game.physics.arcade.enable(player);
            player.body.collideWorldBounds = true;

            // Weapon Tracking on Player
            weapon1.trackSprite(player, (player.width/2), -(player.height/2));
            weapon2.trackSprite(player, (player.width/2), -(player.height/2));

            // Setting Controls
            cursors = this.input.keyboard.createCursorKeys();
            fireButton = this.input.keyboard.addKey(Phaser.KeyCode.Z);
        }

        function update() {
            player.body.velocity.x = 0;
            player.body.velocity.y = 0;

            // Collision Checking
            game.physics.arcade.overlap(player, grunts, playerCollide, null, this);
            game.physics.arcade.overlap(weapon1.bullets, grunts, bulletCollide, null, this);

            // Control Actions
            if (cursors.up.isDown) {
                player.body.velocity.y = -275;
            }
            else if (cursors.down.isDown) {
                player.body.velocity.y = 275;
            }

            if (cursors.left.isDown) {
                player.body.velocity.x = -275;
            }
            else if (cursors.right.isDown) {
                player.body.velocity.x = 275;
            }

            // Check amount of P and then fire appropriate weapon
            if (player.alive && fireButton.isDown) {
                weapon1.fire();
            }

        }

        function playerCollide(player, enemy) {
            player.damage(enemy.damageAmount);
        }

        function bulletCollide(bullet, sprite) {
            bullet.kill();
            sprite.damage(bullet.damageAmount);
        }
    </script>
</body>
</html>